<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="url.css">
    <title>Url SHORTNER</title>
</head>

<body>
    <div class="container">
        <h1>UrL SHORTNER</h1>
        <form id="shortend-form">
            <div>
                <label for="url">Enter Url:</label>
                <input type="url" name="url" id="url" placeholder="Enter URL to shorten" required>
            </div>
            <div>
                <label for="ShortCode">Enter ShortCode:</label>
                <input type="text" name="ShortCode" id="ShortCode" placeholder="Enter URL to shorten" required>
            </div>
            <button type="submit">Shorten</button>
        </form>
        <h2>Shorten Url</h2>
        <ul id="shorten-url"></ul>
    </div>
    <script>

        const fetchShortendUrl=async()=>{
            const response = await fetch("/links");
            const data = await response.json();
            console.log(data);
            const list= document.getElementById('shorten-url');
            list.innerHTML = "";
            for(const [shortCode, url] of Object.entries(data)){
const li =document.createElement('li');
const TruncateUrl= url.length > 30 ?` ${url.slice(0, 30)}... `:url;
                li.innerHTML = `<a href="${url}" target="_blank">${window.location.origin}/${shortCode}</a> - ${TruncateUrl}`;
                list.appendChild(li);
            }               
        }
        document.getElementById('shortend-form').addEventListener('submit', async (e) => {
            event.preventDefault();
            const formdata = new FormData(e.target);
            const url = formdata.get("url");
            const shortCode = formdata.get("ShortCode");
            console.log(url, shortCode);
            try {
                const response = await fetch("/shorten", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ url, shortCode })
                });
                if (response.ok) {
                    fetchShortendUrl()
                    alert("Url Shortened Successfully");
                    e.target.reset();

                } else {
                    const errorData = await response.json();
                    alert(`Error: ${errorData.error || "Something went wrong"}`);
                }
            } catch (error) {
                console.error("Error:", error);
            }
        })
        fetchShortendUrl()
    </script>

</body>

</html>